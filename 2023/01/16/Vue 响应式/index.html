<!DOCTYPE html>
<html>
<head>
	<title>IT Abyss Wiki</title>
	<meta charset="utf-8">

	<!-- 引入配置文件 -->
	
<link rel="stylesheet" href="/css/main.css">


	<!-- 字体图片库 -->
	
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


	<!-- 代码高亮库 -->
	
<link rel="stylesheet" href="/lib/highlight/styles/atom-one-dark.css">

	
<meta name="generator" content="Hexo 5.4.2"></head>
<body>

	<div id="main">
		<!-- 引入侧边栏 -->
		<aside>
			<!-- 搜索栏 -->
<div id="search">
	<input class="search-input" type="text" placeholder="search">
	<i id="search-icon" class="fa fa-bars" title="切换目录与索引">
</div>

<!-- 侧边目录栏 -->
<div id="tree">
	

	
					<ul>
						<li class="file active">
							<a href="/2023/01/16/Vue 响应式/">
								<i class="fa fa-file"></i>
								Vue 响应式
							</a>
						</li>
					</ul>
	
					<ul>
						<li class="file">
							<a href="/2023/01/16/hello-world/">
								<i class="fa fa-file"></i>
								hello-world
							</a>
						</li>
					</ul>
	
</div>


<!-- 最尾部添加，这里就不列以前的代码了 -->
<div id="toc" style="display: none;"></div>

		</aside>

		<!-- 引入导航 -->
		<nav>
			<ul id="menu">
	
	
    <li class="menu-item">
        <a href="/" class="menu-item-link">主页</a>
    </li>
    
    <li class="menu-item">
        <a href="/about" class="menu-item-link">关于</a>
    </li>
    

    
    
    <li class="menu-item">
        <a href="https://www.cnblogs.com/yyhh/" class="menu-item-link" target="_blank">博客园</a>
    </li>
    
    <li class="menu-item">
        <a href="https://github.com" class="menu-item-link" target="_blank">github</a>
    </li>
    

</ul>

		</nav>

		<!-- 引入正文 -->
		<div id="content">
			<div>
	<span id="post-author">猴子请来的救兵</span>
	<span id="post-date">2023-01-16 11:50:08</span>
</div>

<div id="article">
	<h2 id="1-整体目标"><a href="#1-整体目标" class="headerlink" title="1 - 整体目标"></a>1 - 整体目标</h2><ul>
<li><p><input checked="" disabled="" type="checkbox">  了解 <font face="Times New Roman" color=#FFA500>Object.defineProperty</font> 实现原理</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  了解 <font color=#FFA500>指令编译</font> 基础原理</p>
</li>
</ul>
<h2 id="2-响应式"><a href="#2-响应式" class="headerlink" title="2 - 响应式"></a>2 - 响应式</h2><h3 id="2-1-什么是响应式"><a href="#2-1-什么是响应式" class="headerlink" title="2.1 什么是响应式"></a>2.1 什么是响应式</h3><p>响应式指组件 data 的数据一旦变化，立即触发视图的更新。它是实现数据驱动视图的第一步。</p>
<h3 id="2-2-如何实现响应式"><a href="#2-2-如何实现响应式" class="headerlink" title="2.2 如何实现响应式"></a>2.2 如何实现响应式</h3><p>在 JavaScript 里实现数据响应式一般有两种方案：<font face="Times New Roman" color=#FFA500>Object.defineProperty</font> 和 <font face="Times New Roman" color=#FFA500>Proxy</font></p>
<ol>
<li><font face="Times New Roman" color=#FFA500>Vue2.x</font> 的响应式核心是 <font face="Times New Roman" color=#FFA500>Object.defineProperty</font></li>
<li><font face="Times New Roman" color=#FFA500>Vue3.x</font> 的响应式核心是 <font face="Times New Roman" color=#FFA500>Proxy</font></li>
</ol>
<h3 id="2-3-实现对象属性拦截"><a href="#2-3-实现对象属性拦截" class="headerlink" title="2.3 实现对象属性拦截"></a>2.3 实现对象属性拦截</h3><blockquote>
<p><font face="Times New Roman" color=#FFA500>Object.defineProperty()</font> 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> _name = <span class="string">&#x27;章三&#x27;</span>	</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">	<span class="comment">// name 属性返回值</span></span><br><span class="line">	<span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> _name</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// newVal 是设置的新值	</span></span><br><span class="line">	<span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">		name = val</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">name</span>) <span class="comment">// get()</span></span><br><span class="line">data.<span class="property">name</span> = <span class="string">&#x27;里斯&#x27;</span> <span class="comment">// set()</span></span><br></pre></td></tr></table></figure>

<p>利用 <font face="Times New Roman" color=#FFA500>Object.defineProperty</font> 重写 <font face="Times New Roman" color=#FFA500>get</font> 和 <font face="Times New Roman" color=#FFA500>set</font>，将对象属性的赋值和获取变成函数，可以实现一个简单的双向绑定。</p>
<h3 id="2-4-如何监听-data-的变化"><a href="#2-4-如何监听-data-的变化" class="headerlink" title="2.4 如何监听 data 的变化"></a>2.4 如何监听 data 的变化</h3><p>共定义三个函数：</p>
<ul>
<li>updateView: 模拟 Vue 更新视图的入口函数。</li>
<li>defineReactive: 对数据进行监听的具体实现。</li>
<li>observer: 调用函数后，可对目标对象进行监听，将目标对象变成响应式。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触发更新视图</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateView</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;视图更新&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">	<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, &#123;</span><br><span class="line">		<span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> value</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (value !== newVal) &#123;</span><br><span class="line">				value = newVal</span><br><span class="line">				<span class="title function_">updateView</span>()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听对象属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observer</span>(<span class="params">target</span>) &#123;</span><br><span class="line">	<span class="comment">// 监听的不是对象或数组，直接返回</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span> || target === <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> target</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">		<span class="title function_">defineReactive</span>(target, key, target[key])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>每次执行 <font face="Times New Roman" color=#FFA500>defineReactive</font> 函数时，都会形成一个独立的函数作用域，传入的 <font face="Times New Roman" color=#FFA500>value</font> 因为闭包的关系会常驻内存；这样，每个 <font face="Times New Roman" color=#FFA500>defineReactive</font> 函数的 <font face="Times New Roman" color=#FFA500>value</font> 作为各自 <font face="Times New Roman" color=#FFA500>get</font> 和 <font face="Times New Roman" color=#FFA500>set</font> 操作的局部变量。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;章三&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听数据</span></span><br><span class="line"><span class="title function_">observer</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">data.<span class="property">name</span> = <span class="string">&#x27;里斯&#x27;</span></span><br><span class="line">data.<span class="property">age</span> = <span class="number">21</span></span><br></pre></td></tr></table></figure>


<h3 id="2-5-深度监听-data-的变化"><a href="#2-5-深度监听-data-的变化" class="headerlink" title="2.5 深度监听 data 的变化"></a>2.5 深度监听 data 的变化</h3><p>有嵌套属性的对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;章三&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">	<span class="attr">info</span>: &#123;</span><br><span class="line">		<span class="attr">address</span>: <span class="string">&#x27;岳家嘴&#x27;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>在刚进入 <font face="Times New Roman" color=#FFA500>defineReactive</font> 函数时，先调用 <font face="Times New Roman" color=#FFA500>observer</font>，基本类型属性在 <font face="Times New Roman" color=#FFA500>observer</font> 中被直接返回；由于 <font face="Times New Roman" color=#FFA500>info</font> 是对象，所以会对 <font face="Times New Roman" color=#FFA500>info</font> 遍历后执行  <font face="Times New Roman" color=#FFA500>defineReactive</font>。</li>
<li>新值有可能是个对象，在设置新值时也需要对新值进行深度监听。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">	<span class="comment">// 深度监听</span></span><br><span class="line">	<span class="title function_">observer</span>(value)</span><br><span class="line"></span><br><span class="line">	<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, &#123;</span><br><span class="line">		<span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> value</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (newVal !== value) &#123;</span><br><span class="line">				<span class="comment">// 深度监听</span></span><br><span class="line">				<span class="title function_">observer</span>(newVal将)</span><br><span class="line">				value = newVal</span><br><span class="line">				<span class="title function_">updateView</span>()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-6-如何监听数组的变化"><a href="#2-6-如何监听数组的变化" class="headerlink" title="2.6 如何监听数组的变化"></a>2.6 如何监听数组的变化</h3><p>对于数组，通过重写数组方法来实现</p>
<ul>
<li>先备份将原生数组原型（防止后续的操作污染原生数组原型），基于该备份创建一个新的数组，并扩展它的方法。</li>
<li>observer 方法中增加对数组的处理。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触发更新视图</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateView</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;视图更新&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新定义数组原型</span></span><br><span class="line"><span class="keyword">const</span> arrayPrototype = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="keyword">const</span> arrObj = <span class="title class_">Object</span>.<span class="title function_">create</span>(arrayPrototype)</span><br><span class="line">[<span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;shift&#x27;</span>, <span class="string">&#x27;unshift&#x27;</span>, <span class="string">&#x27;splice&#x27;</span>, <span class="string">&#x27;sort&#x27;</span>, <span class="string">&#x27;reverse&#x27;</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">method</span> =&gt;</span> &#123;</span><br><span class="line">	arrObj[method] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="title function_">updateView</span>()</span><br><span class="line">		arrayPrototype[method].<span class="title function_">call</span>(<span class="variable language_">this</span>, ...<span class="variable language_">arguments</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">	<span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, &#123;</span><br><span class="line">		<span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> value</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (newVal !== value) &#123;</span><br><span class="line">				value = newVal</span><br><span class="line">				<span class="title function_">updateView</span>()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听对象属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observer</span>(<span class="params">target</span>) &#123;</span><br><span class="line">	<span class="comment">// 监听的不是对象或数据，直接返回</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span> || target === <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> target</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">		target.<span class="property">__proto__</span> = arrObj</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">		<span class="title function_">defineReactive</span>(target, key, target[key])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;章三&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">	<span class="attr">hobbies</span>: [<span class="string">&#x27;basketball&#x27;</span>, <span class="string">&#x27;one-piece&#x27;</span>] <span class="comment">// 需要监听的数组</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听数据</span></span><br><span class="line"><span class="title function_">observer</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">data.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&#x27;football&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h2 id="3-数据的变化触发视图的更新"><a href="#3-数据的变化触发视图的更新" class="headerlink" title="3 - 数据的变化触发视图的更新"></a>3 - 数据的变化触发视图的更新</h2><blockquote>
<p>将 data 中 name 的值作为文本渲染到标记了 v-text 的标签内部</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 触发更新视图</span><br><span class="line">function updateView() &#123;</span><br><span class="line">	const app = document.getElementById(&#x27;app&#x27;)</span><br><span class="line">	const nodes = app.childNodes</span><br><span class="line">	nodes.forEach(node =&gt; &#123;</span><br><span class="line">		// nodeType 为 1 表示元素节点</span><br><span class="line">		if (node.nodeType === 1) &#123;</span><br><span class="line">			const attrs = node.attributes</span><br><span class="line">			Array.from(attrs).forEach(attr =&gt; &#123;</span><br><span class="line">				const name = attr.name</span><br><span class="line">				const prop = attr.value</span><br><span class="line">				if (name === &#x27;v-text&#x27;) &#123;</span><br><span class="line">					node.innerText = data[prop]</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 首次渲染</span><br><span class="line">updateView()</span><br></pre></td></tr></table></figure>


<h2 id="4-视图的变化同步到数据"><a href="#4-视图的变化同步到数据" class="headerlink" title="4 - 视图的变化同步到数据"></a>4 - 视图的变化同步到数据</h2><blockquote>
<p>将 data 中 name 的值渲染到 input，如果 input 的值发生修改，反向同步到 message。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 触发更新视图</span><br><span class="line">function updateView() &#123;</span><br><span class="line">	const app = document.getElementById(&#x27;app&#x27;)</span><br><span class="line">	const nodes = app.childNodes</span><br><span class="line">	nodes.forEach(node =&gt; &#123;</span><br><span class="line">		// nodeType 为 1 表示元素节点</span><br><span class="line">		if (node.nodeType === 1) &#123;</span><br><span class="line">			const attrs = node.attributes</span><br><span class="line">			Array.from(attrs).forEach(attr =&gt; &#123;</span><br><span class="line">				const name = attr.name</span><br><span class="line">				const prop = attr.value</span><br><span class="line">				if (name === &#x27;v-model&#x27;) &#123;</span><br><span class="line">					node.value = data[prop]</span><br><span class="line">					// 事件监听反向修改</span><br><span class="line">					node.addEventListener(&#x27;input&#x27;, () =&gt; &#123;</span><br><span class="line">						data[prop] = e.target.value</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 首次渲染</span><br><span class="line">updateView()</span><br></pre></td></tr></table></figure>




</div>

		</div>
		
	</div>

	<!-- 引入代码高亮的 js -->
	
<script src="/lib/highlight/highlight.pack.js"></script>


	<!-- 引入 jquery -->
	
<script src="/lib/jquery-3.4.1.min.js"></script>


	<!-- 引入 pjax -->
	
<script src="/lib/jquery.pjax.js"></script>

	
	<!-- 引入 js 文件 -->
	
<script src="/js/main.js"></script>


	<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.0.4/lib/L2Dwidget.min.js"></script>
	<script type="text/javascript">
	L2Dwidget.init();
	</script>

</body>
</html>